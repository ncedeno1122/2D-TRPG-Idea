# BattlePhase State Implementation
Something I just thought of (while in class reviewing the State Pattern) was my initial forays into implementing the State pattern into this project the way I had envisioned. This way allowed me to control the flow of the battle, in my mind, by controlling whose 'phase' it is and all that. You know how in Fire Emblem, a full turn consists of three phases (or so), the Player Phase, Enemy Phase, and Ally Phase, in that order? Yeah, that's what I'm doing but here.

Thinking about it more, there's more utility to be had here. Upon entering one of these states for the phase, the Enter() function should display the banner showing whose turn it is. As well, this also lets me do things like, at the start of the Player phase, activating the cursor for the player, and disabling it in the AI-controlled states and all that. It's sort of a given, but it actualizes some of the things I'd been reviewing about entry and exit functionality in terms of states.
When I go talking about states though, I know that I have to acknowledge *when*, precisely, we exit states and how that occurs. **How** might we get out of this state, in general?
What interests me with the whole Player Phase (and all phases, for that matter) is that a phase is finished when there aren't any more moveable Units available in the phase. If everyone's moved or done something (or done nothing), we can wrap it up. This logic holds true for the AI and all that stuff, and that *seems* pretty easy to handle with some sort of event or something.
However, conceptually, I'm trying to come up with some architecture that handles this somewhat neatly. 

Perhaps I rename it to something like BattlePhase as a state and all that? At the same time though, there are calculations that need to be made. For example,

#### When to apply Tile Effects?
***ALSO***, when is it that Tile effects occur? In FE3H, I believe this occurs at the start of the Phase for each unit? I'm not sure though, that doesn't sound right exactly. This is something I have to figure out. Intuitively, I know that I should probably apply TileEffects at the end of all of the phases, perhaps as its own BattlePhase or something? For example, as everybody on the board moves, when we're ALL done and about to go back into Player Phase, apply all the TileEffects to everyone.
Coming back to this, I wonder if I was to apply these this TileEffects state or whatever I'll call it FOR EACH Phase's units. That is to say, at the beginning of the Player Phase, that I'll apply Tile Effects to each Player Unit. At the beginning of the Enemey Phase, I'll apply Tile Effects to each Enemy Unit. Same for Allied Units, etc.

#### How much variation is acceptable?
I do want to do it the way Fire Emblem did it, though. The entire point of this project was to reconstruct as many Fire Emblem mechanics as I could, but there are these little breakpoints and uncertainties where I realize that my own input and variation could be valuable as well; not just for my interpretation of the architecture and the structure of the game, but for my own personal twists on the genre and all that stuff. Perhaps I'm getting ahead of myself, though, and I need to just get the base structure down before I start remixing and all that.

#### Anyways, back to BattlePhases.
Back on track, though. BattlePhases have to have some exit condition, which is when there are no more Units to perform actions on. A common denominator between these states is that ***they all rely on some List of CharacterUnitScripts*** to manage. In the movement-based states, we have a List of all of the unmoved / unaction'd characters that we decrease until it's Count is 0. In the tile-effect and non-movement states (as far as I currently know), we have a List of characters to apply effects to. Assuming we pop the characters from the List whom we're applying some effect to, the end condition is the same, when the List of remaining characters in the context is empty. There's a little clue for you, I hear the little L.A. Noire jingle when you get something right.

### Now, for something larger-scale!
Now, we have enumerated as many of these states as I can currently think of. Now, what manages them, and how? There's a flow to these states, that you COULD describe as a Circular LinkedList between all the states and all that stuff... Perhaps this comparison is a poor reduction of what's at hand, though. In implementing the State Pattern, I do have some control over what state occurs *next*, potentially from the current state as well. Thus, I wouldn't *have* to reduce it down to some LinkedList-esque cycle, though it does seem like that.
It seems like the biggest help for my understanding is a hearty ladel-ful of State Pattern Soup. Taking advantage of the transitions between States seems to be where this implementation will exceed: in applying TileEffects, incrementing the Turn counter, things like that, and handling conditional events and all of that stuff.

